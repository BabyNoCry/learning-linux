基础二： 
探讨问题：
tcp链接异常的问题
长连接 与 短连接  
listen 的第二个参数
全连接 与  半连接： 

网络基础 3：
ip 提供的功能： 提供了一种将数据从A主机 经过路径选择送至B主机的能力
注意：有能力不代表一定可以做到
Tcp + ip = 提供了一种将数据从A主机 经过路径选择“可靠“ 送至B主机的能力
路径选择：在众多局域网中查找目标网络 + 再查找目标主机
路由时通过网络号进行路由，到了目标网络后，在通过局域网通信原理将数据交给目标主机。
因此：路由器要链接连个以上网路
IP = 网络号 + 主机号        所有的网络号相同的主机构成一个局域网

ip协议：
ip协议头格式：
4为版本号  4位首部长度（单位4字节）              8位服务类型（）                             16位总长度（单位字节）
              16位标识（标识分片）                                                                             3位标志（1位保留 2禁止分片（若ip报文大小大于MTU 会被抛弃，MTU：数据链路层 MAC帧最大传输1500字节数据（有效载荷） ，最大传输单元） 3标识更多分片（1标识最后一个分片 0标识其他分片））    13位片偏移（分片相对于原报文的偏移 单位8字节）
8位生存时间（TTL  没经过一次路由转发TTL--， 8位协议（表示上层协议的类型）       16位首部校验和（ 使用CRC进行校验, 来鉴别头部是否损坏. ）
		减到0 抛弃该报文）
                                                                        32位源IP地址 
				        32位目的ip地址
				        选项（如果有，可能没有）
					数据
问题：判断一个ip报文是否是经过分片的？  
看13位片偏移是否为0（情况一：0没有分片  情况二： 是第一个分片），然后看3位标志，若第三位更多分片设置为1,则说明分片了，否则没有分片。
片偏移不为0，则是改报文是分片。
如何组装？ 	
	通过片偏移进行排序。  通过三位标志第三位 判断是否是最后一个分片。
有一个ip报文大小为3000字节，问至少分为几片？  三片。

分片的坏处：出错概率提高，拆分组装浪费两段资源，可靠性降低。

分片谁说了算？传输层 --> MSS：最大报文段长度    MSS = MTU - TCP报文 - IP报文 .  为什么规定MSS：尽可能防止下层进行较多的分片行为。 
	
首部最长为 60字节  

怎么样进行报头和有效载荷的分离？
	16位总长度，和4位首部长度来决定报头和载荷的大小，从而进行分离。
如何进行交付？
	

网段划分：
DHCP 动态主机配置协议
为什么要进行网段划分？
网络传输时更快的进行路由。
CIDR（无类别域间路由）：缓解ip地址不够用的问题

引入一个额外的子网掩码(subnet mask)来区分网络号和主机号; 
子网掩码也是一个32位的正整数. 
通常用一串 "0" 来结尾; 将IP地址和子网掩码进行 "按位与" 操作, 得到的结果就是网络号; 
网络号和主机号的划分与这个IP地址是A类、B类还是C类无关

特殊的ip：
1. IP地址中主机号全为0 ，就成了网络号，代表这个网络
2. ip地址中主机号为全1，就成为了广播地址，用于给同一个网络中的所有主机发送数据包。
3.127.* 的ip地址用于本地换回（loop back ）测试，通常是127.0.0.1

私有ip：
如果一个组织内部组建局域网,IP地址只用于局域网内的通信,而不直接连到Internet上,理论上 使用任意的IP地址都 可以,但是RFC 1918规定了用于组建局域网的私有IP地址 
IP地址只用于局域网内的通信,而不直接连到Internet上的ip地址称为私有ip
私有ip范围：
10.0.0.0 ~  10.255.0.0
172.16.0.0~ 172.31.255.255
192.168.0.0 ~ 192.168.255.255
其余的都属于公网ip。
区别：
公网ip在全网内唯一，私有ip仅在当前局域网内唯一。私有ip不可能出现在公网上，私有ip可能是重复的。私有ip只能用来构建局域网。

NAT（网络地址转化）：将私有ip替换为WAN口ip，解决ip地址不足的问题

现在来说说linux桥接，和NAT模式的不同：
桥接模式下，我们的linux和windows属于同一个局域网，地位是平等的，因此linux可以与windows所在局域网中的任意一个主机进行通信。
NAT则不同，该模式下linux是windows 所构建的一个局域网中的一台主机，要与其他主机进行通信时，需要windows将其ip地址替换为windows的WAN口ip，这样就可以实现主机间的通信，
接收消息时通过查找路由器中的转换表。（要是两个主机访问的是同一台服务器，那么ip会被替换为同一个WAN口ip，但是绑定的端口号不同，用于区分。）

NAT解决ip地址不足的问题，凭什么解决：有了私有ip，允许ip地址重复，可重复就导致可用ip变多。
缺陷：
1.无法从NAT外部向内部服务器建立连接; 
2.装换表的生成和销毁都需要额外开销; 
3.通信过程中一旦NAT设备异常, 即使存在热备, 所有的TCP连接也都会断开;

代理服务器：解决应用层的需求		作用 ：1.在服务器集群中进行负载均衡（局域网中的代理） 好处：1.更均衡使用集群内资源  2. 使整个集群的抗压性提高  3. 多个服务器同时运行，提高效率。 
				           2.翻墙（广域网中的代理）

路由：
路由时是根据目的网络来进行路径选择的。

自主学习： 
	有向图，无向图。  深度优先、广度优先。
 	NAT穿越？ 代理服务器？（是什么？用在什么？正反代理？怎么搭建代理服务器？什么服务器经常被搭建为代理服务器？）

MAC帧中的类型：0800 -->ip   


数据链路层：解决局域网内，数据的转发的问题
网络层：解决将数据从A主机跨网络经过路径选择送至B主机的能力。
传输层：数据怎么传？什么时候传？传多少的问题。

三者结合：将数据可靠的从一个主机送到另一个主机（基础网络功能）。

